@import logic.GitHubV3Format.Contributor
@import logic.Analytics._
@(name: String, contributors: Seq[Contributor], userActivity: Seq[UserActivity], userActivity2: Seq[UserActivity2], dateActivity: Seq[DateActivity])

@main(s"$name statistics") {

    <div class="panel panel-default">
        <div class="panel-heading">
            <h2 >Statistics for: <a href="https://github.com/@name">@name</a></h2>
        </div>
    </div>

    <div class="panel panel-default">
        <div class="panel-heading">Contributors:</div>
        <div class="panel-body">
        <div class="list-group">
            <div class="row">
        @for(r <- contributors) {
            <a href="https://github.com/@r.login" class="list-group-item col-xs-4">
            @r.login
            </a>
        }
        </div></div></div>
    </div>

    <div class="panel panel-default">
        <div class="panel-heading">Recent activity (over last 100 commits):</div>
        <div id="userActivityGraph"></div>
        <ul id="userActivityTable" class="list-group">
        @for(c <- userActivity) {
            <li class="list-group-item">
                @c._1.map(_.login).getOrElse("Unknown users"): @c._2
            </li>
        }
        </ul>
    </div>

    <div class="panel panel-default">
        <div class="panel-heading">Activity per date:</div>
        <div id="dateActivityGraph"></div>
        <ul id="dateActivityTable" class="list-group">
        @for(date <- dateActivity) {
            <li class="list-group-item">
                <div class="row">
                    <div class="col-xs-4">
                    @date._1
                    </div>
                    <div class="col-xs-8">
                        <ul class="list-group">
                        @for(user <- date._2) {
                            <li class="list-group-item">
                                @user._1.map(_.login).getOrElse("Unknown users"): @user._2
                            </li>
                        }
                        </ul>
                    </div>
                </div>
            </li>
        }
        </ul>
    </div>


    <script type="text/javascript">
        $(function () {
            $( "#userActivityTable" ).remove();
            $('#userActivityGraph').highcharts({
                chart: {
                    plotBackgroundColor: null,
                    plotShadow: false
                },
                title: {
                    text: ''
                },
                tooltip: {
                    pointFormat: '{series.name}: <b>{point.y} ({point.percentage:.1f}%)</b>'
                },
                plotOptions: {
                    pie: {
                        allowPointSelect: true,
                        cursor: 'pointer',
                        dataLabels: {
                            enabled: true,
                            format: '<b>{point.name}</b>: {point.y} ({point.percentage:.1f}%)',
                            style: {
                                color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black'
                            }
                        }
                    }
                },
                series: [{
                    type: 'pie',
                    name: 'Recent activity',
                    data: [
                        @for(c <- userActivity) {
                            ['@c._1.map(_.login).getOrElse("Unknown users")', @c._2],
                        }
                    ]
                }]
            });
        });


    </script>
    <script type="text/javascript">
$(function () {
    $("#dateActivityTable" ).remove();
    $('#dateActivityGraph').highcharts('StockChart', {
        chart: {
            type: 'column',
        },
        rangeSelector: {
                selected: 2
        },
        title: {
            text: ''
        },

        xAxis: {
            type: 'datetime',
        },
        yAxis: {
            title: {
                text: 'Number of commits'
            }
        },
        plotOptions: {
            column: {
                stacking: 'normal',

            },
            series: {
                dataGrouping: {
                    groupPixelWidth: 100
                }
            }
        },
        series: [

        @for(user <- userActivity2) {
            {
                name: '@user._1.map(_.login).getOrElse("Unknown users")',
                data: [
                    @for(date <- user._2) {
                        [@date._1.getMillis(), @date._2],
                    }
                ]
            },
         }
        ]
    });
});
    </script>
}
